(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{239:function(t,s,a){"use strict";a.r(s);var n={props:["slot-key"],mounted:function(){this.$nextTick(function(){this.$vuepress.$emit("AsyncMarkdownContentMounted",this.slotKey)})}},o=a(5),p=Object(o.a)(n,function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.slotKey}},[a("h1",{attrs:{id:"三方开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三方开发","aria-hidden":"true"}},[t._v("#")]),t._v(" 三方开发")]),t._v(" "),a("p",[t._v("三方小程序和普通的小程序本质上没有不同，但三方开发面临的复杂度相对较高，且开发过程中却存在着很多额外的痛点。")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("开发难度")])])]),t._v(" "),a("p",[t._v("一个三方小程序往往不会只提供给单独的第三方，相反我们希望逻辑代码能够复用到其他的合作方小程序中，与此同时，界面 UI 我们允许有限度的修改。")]),t._v(" "),a("p",[t._v("更高级点，可能每个合作方需要定制自己的一些页面，这个时候我们还需要为特定合作方开发特定页面，并且控制页面入口。")]),t._v(" "),a("p",[t._v("上述需求在三方开发中非常常见，我们需要兼顾"),a("strong",[t._v("代码可复用")]),t._v("，"),a("strong",[t._v("小程序打包体积")]),t._v("，"),a("strong",[t._v("UI 换肤")]),t._v("等等。而这些在原生开发中是不可能完美做到的，原生的小程序只有一个运行时的途径区分不同三方小程序（即 "),a("code",[t._v("ext.json")]),t._v(" 和 "),a("code",[t._v("wx.getExtConfigSync")]),t._v("）")]),t._v(" "),a("p",[t._v("因此我们开发三方小程序的时候往往需要单独的去写脚本替换文件，指定打包到不同目录等等。但是在面临一些优化问题的时候，简单的脚本就显得无能为力了，譬如不同的合作方都要求有自己的一些活动页面，我们并不希望 A 的活动页面打包到 B 的代码中，我们希望不同合作方能按“需”打包，而按“需”这件事情如果通过脚本来做的话，我们得专门给每个合作方编写特定脚本，繁琐且不易维护。")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("分发和部署难度")])])]),t._v(" "),a("p",[t._v("当三方小程序需要更新的时候，我们需要一个一个合作方的输出小程序代码，然后使用开发者工具一个个小程序的上传代码，预览小程序，提交体验版。当接入方少的时候，手动的重新这些过程还能接受，但是如果有10个、20个合作方，这么做就很不人道了。")]),t._v(" "),a("p",[t._v("故 wxa2.x 专门为三方开发设计了一些套路解决上述痛点。")]),t._v(" "),a("h2",{attrs:{id:"开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发","aria-hidden":"true"}},[t._v("#")]),t._v(" 开发")]),t._v(" "),a("p",[t._v("代码复用的问题。既然在三方开发中，大部分页面都可以复用，那么我们只需要一次性多次编译、输出到不用的文件夹就可以了。")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("wxa.config.js")]),t._v(" 中指定 "),a("code",[t._v("thirdParty")]),t._v(" 配置项：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    thirdParty"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'partner-A'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            wxaConfigs"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                output"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    path"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'partners/A'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("可以看到，我们在 "),a("code",[t._v("thirdParty/wxaConfigs")]),t._v(" 中指定了不同的项目名和输出路径，这样一来，我们就可以为每个不同的合作方输出单独的小程序代码了。")]),t._v(" "),a("p",[t._v("但是这样子不够，不同合作方的项目参数都不一样，而且生产和测试的参数也不一致，譬如远程服务器地址，是否允许打印特定的错误信息等等。我们需要在运行时能区分当前是哪个合作方的小程序处于哪个环境。此时可以使用 "),a("code",[t._v("@wxa/plugin-replace")]),t._v(" 实现效果：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    thirdParty"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'partner-A'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            wxaConfigs"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                output"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    path"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'partners/A'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                plugins"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                    "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ReplacePlugin")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        list"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./projects/A/app.config.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("插件文档请查看："),a("a",{attrs:{href:"https://wxajs.github.io/wxa/plugin/cli/replace.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("@wxa/plugin-replace")]),a("OutboundLink")],1),t._v("。通过为不同合作方使用不同的插件，我们可以给不同的合作方替换不同的参数，指定是否需要压缩代码，是否需要使用PostCss等。")]),t._v(" "),a("p",[t._v("这样子一来，我们就可以为不同合作方输出不同小程序代码了，接下来我们需要解决 "),a("strong",[t._v("UI 换肤")]),t._v("和 "),a("strong",[t._v("打包体积")]),t._v("两个问题。这两个问题也可以理解为三方小程序"),a("strong",[t._v("个性化")]),t._v("问题。怎么为不同合作方个性化呢？")]),t._v(" "),a("p",[t._v("首先是样式方面，小程序 "),a("code",[t._v("app.wxss")]),t._v(" 定义的样式属于全局样式，所有页面都生效。既然如此我们可以为不同的合作方替换指定的 "),a("code",[t._v("app.wxss")]),t._v("，再配合"),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/CSS/var",target:"_blank",rel:"noopener noreferrer"}},[t._v("CSS-VAR"),a("OutboundLink")],1),t._v("，就可以实现 UI 换肤功能了。")]),t._v(" "),a("p",[t._v("其次是打包体积，不同合作方定制的页面我们并不想全部输出。只要输出到指定合作方代码即可。幸运的是，开发的依赖分析功能可以根据 "),a("code",[t._v("app.json")]),t._v(" 指定的 "),a("code",[t._v("pages")]),t._v(" 和 "),a("code",[t._v("subPackage")]),t._v(" 打包相应的页面以及依赖。")]),t._v(" "),a("p",[t._v("也就是说我们只需要为不同合作方替换不同的 "),a("code",[t._v("app.json")]),t._v(" 即可解决打包体积的问题。")]),t._v(" "),a("p",[t._v("改动 "),a("code",[t._v("wxa.config.js")]),t._v(" 配置如下：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    thirdParty"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'partner-A'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            point"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{attrs:{class:"token string"}},[t._v("'app.json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'projects/A/app.json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token string"}},[t._v("'ext.json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'projects/A/ext.json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token string"}},[t._v("'app.scss'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'projects/A/app.scss'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            wxaConfigs"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                output"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    path"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'partners/A'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                plugins"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                    "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ReplacePlugin")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        list"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./projects/A/app.config.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'partner-B'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            point"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{attrs:{class:"token string"}},[t._v("'app.json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'projects/B/app.json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token string"}},[t._v("'ext.json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'projects/B/ext.json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token string"}},[t._v("'app.scss'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'projects/B/app.scss'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            wxaConfigs"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                output"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    path"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'partners/B'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                plugins"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                    "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ReplacePlugin")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        list"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./projects/B/app.config.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("至此，我们为不同合作方指定替换了入口文件 "),a("code",[t._v("app.scss")]),t._v(" 、 "),a("code",[t._v("ext.json")]),t._v(" 和 "),a("code",[t._v("app.json")]),t._v("。为不同合作方维护不同的 UI 皮肤，指定打包编译的 pages，输出特性的定制页面。")]),t._v(" "),a("p",[t._v("我们通过下面的命令开始一次性的输出所有合作方配置：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("wxa2 build --multi\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 或者使用缩写")]),t._v("\nwxa2 build -m\n")])])]),a("p",[t._v("开发阶段可以指定启动监听模式单独编译某个合作方")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("wxa2 build --watch --multi --project projectName\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 使用缩写")]),t._v("\nwxa2 build -w -m -p projectName\n")])])]),a("h2",{attrs:{id:"部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署","aria-hidden":"true"}},[t._v("#")]),t._v(" 部署")]),t._v(" "),a("p",[t._v("在完成三方开发之后，我们需要批量的部署三方小程序。部署方面主要是利用"),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/devtools/cli.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("小程序CLI调用"),a("OutboundLink")],1),t._v("，搭配批量上传代码能力完成。")]),t._v(" "),a("p",[t._v("首先在 "),a("code",[t._v("wxa.config.js")]),t._v(" 配置好微信开发者工具的安装路径 "),a("code",[t._v("wechatwebdevtools")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    wechatwebdevtools"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'/Applications/wechatwebdevtools.app'")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("然后再运行下面的命令即可完成批量上传。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# 一次性上传多个项目")]),t._v("\nwxa2 cli --action upload --multi \n"),a("span",{attrs:{class:"token comment"}},[t._v("# 指定上传特定项目")]),t._v("\nwxa2 cli --action upload --multi --project projectName\n")])])]),a("p",[t._v("需要注意的是，"),a("strong",[t._v("由于微信开发者工具依赖 "),a("code",[t._v("project.config.json")]),t._v(" 进行小程序项目管理")]),t._v("，而现阶段该配置文件只能由微信开发者工具生成，故在进行 CLI 调用之前，需要提前用开发者工具生成该配置文件。")]),t._v(" "),a("p",[t._v("上传完项目代码，之后只需要调用"),a("a",{attrs:{href:"https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&t=resource/res_list&verify=1&id=open1489144594_DhNoV&token=&lang=zh_CN",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信三方平台接口"),a("OutboundLink")],1),t._v("，批量提审，发布了。")]),t._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("我们可以在 "),a("code",[t._v("ext.json")]),t._v(" 中配置 "),a("code",[t._v("directCommit")]),t._v(" 为 "),a("code",[t._v("true")]),t._v("，这样子上传的三方小程序代码会直接上传到体验版。")])])])},[],!1,null,null,null);p.options.__file="third-party-wxa.md";s.default=p.exports}}]);