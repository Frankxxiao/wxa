(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{248:function(t,s,a){"use strict";a.r(s);var n={props:["slot-key"],mounted:function(){this.$nextTick(function(){this.$vuepress.$emit("AsyncMarkdownContentMounted",this.slotKey)})}},e=a(5),o=Object(e.a)(n,function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.slotKey}},[a("h1",{attrs:{id:"从-wxa1-x-迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从-wxa1-x-迁移","aria-hidden":"true"}},[t._v("#")]),t._v(" 从 wxa1.x 迁移")]),t._v(" "),a("p",[t._v("从 wxa1.x 升级到 wxa2.x 需要按以下步骤：")]),t._v(" "),a("ol",[a("li",[t._v("升级依赖")]),t._v(" "),a("li",[t._v("修改配置")]),t._v(" "),a("li",[t._v("升级 API")])]),t._v(" "),a("p",[t._v("在开始升级之前，首先安装好 "),a("code",[t._v("@wxa/cli2")]),t._v(" 和 "),a("code",[t._v("babel-upgrade")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i -g @wxa/cli2 babel-upgrade\n")])])]),a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("由于目前 2.x 还在beta阶段，安装 "),a("code",[t._v("@wxa")]),t._v(" 的依赖请指定 tag 为 next，例如 "),a("code",[t._v("@wxa/cli2")]),t._v("，"),a("code",[t._v("@wxa/core")]),t._v("。")])]),t._v(" "),a("h2",{attrs:{id:"升级依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#升级依赖","aria-hidden":"true"}},[t._v("#")]),t._v(" 升级依赖")]),t._v(" "),a("p",[t._v("需要升级 "),a("code",[t._v("@wxa")]),t._v(" 相关的依赖有：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@wxa/core")])]),t._v(" "),a("li",[a("code",[t._v("@wxa/compiler-babel")])]),t._v(" "),a("li",[a("code",[t._v("@wxa/compiler-sass")])]),t._v(" "),a("li",[a("code",[t._v("@wxa/compiler-stylus")])]),t._v(" "),a("li",[a("code",[t._v("@wxa/plugin-replace")])]),t._v(" "),a("li",[a("code",[t._v("@wxa/plugin-uglifyjs")])])]),t._v(" "),a("p",[t._v("可以使用下面命令完成安装:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# 安装core包")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i -S @wxa/core\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 安装编译包，可以选择是否使用相应插件")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i -D @wxa/compiler-babel @wxa/compiler-sass @wxa/plugin-replace @wxa/plugin-uglifyjs\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 可选是否使用 stylus")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i -D @wxa/compiler-stylus\n")])])]),a("p",[t._v("由于 wxa2.x 版本全面转到 babel7 ，同 babel6 相比，毫无疑问 babel7 是一个巨大飞跃的版本，故我们需要升级所有 babel 相关依赖，幸运的是 "),a("code",[t._v("babel-upgrade")]),t._v(" 可以自动找出所有需要修改的地方，并修改。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# 查询需要修改的依赖")]),t._v("\nbabel-upgrade\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 查询并修改所有依赖")]),t._v("\nbabel-upgrade -w\n")])])]),a("p",[t._v("通过 "),a("code",[t._v("babel-upgrade -w")]),t._v(" 我们一键修改了所有babel相关的配置，然后只要重新安装一遍依赖就好了：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i\n")])])]),a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("值得一提的是 1.x 的 wxa cli 工具支持到 node6，而 2.x 版本只支持 node8+ 的版本，所以如果 node 版本过低的话，需要重新安装 node。安装完 node 之后，依赖需要重新 rebuild")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# 重新构建C++模块")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" rebuild\n")])])])]),t._v(" "),a("h2",{attrs:{id:"修改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 修改配置")]),t._v(" "),a("p",[t._v("如果在 wxa1.x 中没有使用到 "),a("code",[t._v("compiler")]),t._v(" 配置项，该步骤可以省略，否则需要修改相关compiler的配置。")]),t._v(" "),a("p",[t._v("修改 1.x 的 "),a("code",[t._v("wxa.config.js")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 使用到的compiler")]),t._v("\n    use"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'babel'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'sass'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// compiler的配置，如果需要单独配置compiler，写在这里")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("    compilers"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("        "),a("span",{attrs:{class:"token comment"}},[t._v("// 下面的babel配置也可以写到.babelrc中")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("       babel"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("            "),a("span",{attrs:{class:"token string"}},[t._v('"sourceMap"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("            "),a("span",{attrs:{class:"token string"}},[t._v('"presets"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"env"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("            "),a("span",{attrs:{class:"token string"}},[t._v('"plugins"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("                "),a("span",{attrs:{class:"token string"}},[t._v('"transform-class-properties"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("                "),a("span",{attrs:{class:"token string"}},[t._v('"transform-decorators-legacy"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("                "),a("span",{attrs:{class:"token string"}},[t._v('"transform-object-rest-spread"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("                "),a("span",{attrs:{class:"token string"}},[t._v('"transform-export-extensions"')]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("            "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("            "),a("span",{attrs:{class:"token string"}},[t._v('"ignore"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"node_modules"')]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n")])])]),a("p",[t._v("改为：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    use"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            test"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token regex"}},[t._v("/\\.js$|\\.wxs$/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'babel'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            options"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{attrs:{class:"token string"}},[t._v('"sourceMap"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token string"}},[t._v('"presets"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"@babel/preset-env"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token string"}},[t._v('"plugins"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                    "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"@babel/plugin-transform-runtime"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token string"}},[t._v('"version"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"7.2.0"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"@babel/plugin-proposal-decorators"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token string"}},[t._v('"decoratorsBeforeExport"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"@babel/plugin-proposal-class-properties"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{attrs:{class:"token string"}},[t._v('"ignore"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                    "),a("span",{attrs:{class:"token string"}},[t._v('"node_modules"')]),t._v("\n                "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            test"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token regex"}},[t._v("/\\.sass$|\\.scss$/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'sass'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n")])])]),a("p",[t._v("或者将相关配置放到单独的文件，譬如 babel 的配置放到项目根目录的 "),a("code",[t._v(".babelrc")]),t._v(" 或者 "),a("code",[t._v("babel.config.js")]),t._v("。")]),t._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("为了使代码体积能够最小化，从 2.x 开始，wxa使用 "),a("code",[t._v("@babel/plugin-transform-runtime")]),t._v(" 和 "),a("code",[t._v("@babel/runtime")]),t._v(" 来删除多余 helper 文件、支持 Async/Await 等语法。\n此外，由于 wxa 大量应用 Decorator，而 Decorator 的提案还在第2阶段，我们需要手动指定 runtime 版本（可以在 node_modules/@babel/runtime/package.json 找到），才可以删除多余的 decorate helper函数，譬如上面的 "),a("code",[t._v("7.2.0")]),t._v("。")]),t._v(" "),a("p",[t._v("相关"),a("a",{attrs:{href:"https://github.com/tc39/proposal-decorators",target:"_blank",rel:"noopener noreferrer"}},[t._v("proposal"),a("OutboundLink")],1),t._v("，相关"),a("a",{attrs:{href:"https://github.com/babel/babel/issues/8766",target:"_blank",rel:"noopener noreferrer"}},[t._v("ISSUE"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("h2",{attrs:{id:"升级-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#升级-api","aria-hidden":"true"}},[t._v("#")]),t._v(" 升级 API")]),t._v(" "),a("p",[t._v("2.x 中为了方便区分业务 API 和框架API，将所有内置函数都加了 "),a("code",[t._v("$")]),t._v(" 前缀，如下：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("this.app")]),t._v(" -> "),a("code",[t._v("this.$app")])]),t._v(" "),a("li",[a("code",[t._v("this.storage")]),t._v(" -> "),a("code",[t._v("this.$storage")])]),t._v(" "),a("li",[a("code",[t._v("this.router")]),t._v(" -> "),a("code",[t._v("this.$router")])]),t._v(" "),a("li",[a("code",[t._v("this.eventbus")]),t._v(" -> "),a("code",[t._v("this.$eventbus")])]),t._v(" "),a("li",[a("code",[t._v("this.fetch")]),t._v(" -> "),a("code",[t._v("this.$fetch")])]),t._v(" "),a("li",[a("code",[t._v("this.utils")]),t._v(" -> "),a("code",[t._v("this.$utils")])]),t._v(" "),a("li",[a("code",[t._v("this.wxapi")]),t._v(" -> "),a("code",[t._v("this.$wxapi")])])]),t._v(" "),a("p",[t._v("最后在命令行跑起来：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wxa2 build --watch\n")])])]),a("p",[t._v("至此，2.x 升级完毕，enjoy it! 😋")])])},[],!1,null,null,null);o.options.__file="migrade1.x.md";s.default=o.exports}}]);